0. Find their Readme:
https://www.ebi.ac.uk/ega/submission/tools/EGA_webin

1. Make upload account
this account is shared, choose password wisely

You have to request it and will receive it some time later

They will send you a form (Submission statement). It has to be signed by the PI and returned.

Only then you will receive credentials and an unlocked (box-)account

->
https://ega-archive.org/submission/quickguide

->
submission form:

https://ega-archive.org/submission-form.php

2. Login to EGA webin - most work has to be done in this portal
https://www.ebi.ac.uk/ena/submit/sra/#ega

use box account

3. Choose 'New Submission'

4. Choose 'Register study (project)'

=============================================================================================================

Dear Colleague,

Thank you for your recent submission to the European Genome-phenome Archive with your account 'EGAB00000001982'.

We are pleased to advise you that the metadata has passed validation and the following accession numbers have been assigned:

Your study accession number is: EGAS00001004570
Your study unique name is: ena-STUDY-ErasmusMC-23-07-2020-15:10:08:005-1656

Please DO NOT reply to this email. If you need further assistance, email ega-helpdesk@ebi.ac.uk .

Accession Summary
-----------------
Type Accession Unique Name
Study EGAS00001004570 ena-STUDY-ErasmusMC-23-07-2020-15:10:08:005-1656

Kind regards,

European Genome-phenome Archive (EGA)

=============================================================================================================

4.b
 - Find your samples, symlink them into the a directory in which you want to have the GPG encrpyted equivalents

5. Choose 'Register Samples' [https://www.ebi.ac.uk/ena/submit/sra/#ega]

 - Select the basic template, download the TSV.
 - Complete the tsv rather than uploading everything online.
 - Make sure the left column (1st column) contains unique sample identifiers.
 - Upload and submit
 

File format for to be uploaded tsv file [per subject?]:
=============================================================================================================
#checklist_accession	ERC000026														
#unique_name_prefix															
sample_alias	tax_id	scientific_name	common_name	sample_title	sample_description	subject_id	gender	phenotype	disease_site	sample type	donor_id	dataset_source	treatment	survival_time_y	survival_status
#template	9606	Homo sapiens	human	-	RNA-Seq		female	glioblastoma	brain	diseased tissue		belob	ccnu	-	-
#units															
belob.10	9606	Homo sapiens	human	10		10	female	glioblastoma	brain	diseased tissue	10	belob	BC 90/110	1.8	Dead
belob.11	9606	Homo sapiens	human	11		11	female	glioblastoma	brain	diseased tissue	11	belob	CCNU	10.8	Dead
belob.13	9606	Homo sapiens	human	13		13	female	glioblastoma	brain	diseased tissue	13	belob	Beva	13.1	Dead
belob.15	9606	Homo sapiens	human	15		15	male	glioblastoma	brain	diseased tissue	15	belob	Beva	17.5	Dead
=============================================================================================================



6. Prepare files, later submit w/ 'Submit sequence reads and experiments'

 - Use EGACryptor to encrypt sequencing data?
   supported formats: https://ega-archive.org/submission/sequence
   https://www.ebi.ac.uk/ega/submission/tools/EGA_webin_data_uploader

 - java -jar EgaCryptor/EgaCryptor.jar -file file.fa.gz 
   THIS TOOL DOES NOT UNDERSTAND PATHS, SO SIMLINK THE INPUT FILES INTO THE SAME WORKING DIRECTORY
   
   cli has changed in 2021:
   
   nice java -jar bin/EGA-Cryptor-2.0.0/ega-cryptor-2.0.0.jar -f -o upload -i 'EAE2-2194_NGS19-J469_AHM2NJDSXX_S17_L002_R1_001.fastq.gz,EAE2-2194_NGS19-J469_AHM2NJDSXX_S17_L002_R2_001.fastq.gz'

 - Upload them [gpg; gpg.md5; md5] in some sort of (s)FTP?
   tool: https://www.ebi.ac.uk/ega/submission/tools/FTP_aspera
   filezilla:
   ftp://ega-box-????:pwd@ftp.ega.ebi.ac.uk
   
   or [because filezille connection sometimes closes]:
   curl -T filename.fastq.gz ftp://ftp.ega.ebi.ac.uk/dir/ --user ega-box-1234:password

 - This submission has no web form; combining data and metadata is considered a 'dataset'

7. Choose 'Register data access committee (DAC)'

 - Not sure whether to add the Group leader, PI or myself? I added myself but group leader seems more sustainable. Contacts + description can be changed later

8. Choose 'Register data access policy'

 - Link the just created DAC
 - If the DAC does not pop-up, press 'Reset' and it will most likely appear
 
 In the past we used a text similar to this:
 
=============================================================================================================
This agreement governs the terms on which access will be granted to the phenotype and genotype data generated by the <...> consortium.
=============================================================================================================
THE <...> CONSORTIUM DATA ACCESS AGREEMENT

This agreement governs the terms on which access will be granted to the 
phenotype and genotype data generated by the <...> consortium.

In signing this agreement, You are agreeing to be bound by the terms and 
conditions of access set out in this agreement.

For the sake of clarity, the terms of access set out in this agreement 
apply both to the User and the User’s Institution (as defined below). 
User Institution and User are referred to within the agreement as “You” 
and “Your” shall be construed accordingly.

Definitions:

Consortium means the <...> Consortium comprised out of the following 
members: 
Dr. <...> and Prof. Dr. <...> and Dr. <...>.

Data means all and any human genetic/transcriptomic data and matching
metadata obtained from the Consortium.

Data Subject means a person, who has been informed of the purpose for 
which the Data is held and has given his/her informed consent thereto.

User means a researcher whose User Institution has previously completed 
this Data Access Agreement and has received acknowledgement of its 
acceptance.

Publications means, without limitation, articles published in print 
journals, electronic journals, reviews, books, posters and other written 
and verbal presentations of research.

User Institution means the organization at which the User is employed, 
affiliated or enrolled.

Terms and Conditions:
In signing this Agreement:
1. You agree to use the Data only for the advancement of medical 
research, according to the consent obtained from sample donors.

2. You agree not to use the data from this cohort or any part thereof 
for the creation of products for sale or for any commercial purpose.

3. You agree to preserve, at all times, the confidentiality of 
information and Data pertaining to Data Subjects. In particular, You 
undertake not to use, or attempt to use the Data to compromise or 
otherwise infringe the confidentiality of information on Data Subjects 
and their right to privacy.

4. You agree not to attempt to link the data provided under this 
agreement to other information or archive data available for the data 
sets provided, even if access to that data has been formally granted to 
you, or it is freely available without restriction, without specific 
permission being sought from the relevant access committees.

5. You agree not to transfer or disclose the Data, in whole or part, or 
any identifiable material derived from the Data, to others, except as 
necessary for data/safety monitoring or programme management. Should You 
wish to share the Data with a collaborator within the same Institution, 
the third party must make a separate application for access to the Data.

6. You agree to use the data for the approved purpose and project 
described in your application; use of the data for a new purpose or 
project will require a new application and approval. The relevant access 
committees will see to it that the Data is not used in publications 
outside the project described in the original application.

7. You accept that Data will be reissued from time to time, with 
suitable versioning. If the reissue is at the request of sample donors 
and/or other ethical scrutiny, You will destroy earlier versions of the 
Data.

8. You agree to abide by the terms outlined in the Consortium 
'Publications Policy' as set out in Schedule 1.

9. You agree to acknowledge in any work based in whole or part on the 
Data, the published paper from which the Data derives, the version of 
the data, and the role of the Consortium and the relevant primary 
collectors and their funders. Suitable wording is provided in the 
Publications Policy given in Schedule 1.

10. You accept that the Consortium, the original data creators, 
depositors or copyright holders, or the funders of the Data or any part 
of the Data supplied: a) bear no legal responsibility for the accuracy 
or comprehensiveness of the Data; and b) accept no liability for 
indirect, consequential, or incidental, damages or losses arising from 
use of the Data, or from the unavailability of, or break in access to, 
the Data for whatever reason.

11. You understand and acknowledge that the Data is protected by 
copyright and other intellectual property rights, and that duplication, 
except as reasonably required to carry out Your research with the Data, 
or sale of all or part of the Data on any media is not permitted.

12. You recognize that nothing in this agreement shall operate to 
transfer to the User Institution any intellectual property rights 
relating to the Data. The User Institution has the right to develop 
intellectual property based on comparisons with their own data.

13. You accept that this agreement will terminate immediately upon any 
breach of this agreement by You and You will be required to destroy any 
Data held.

14. You accept that it may be necessary for the Consortium or its 
appointed agent to alter the terms of this agreement from time to time 
in order to address new concerns. In this event, the Consortium or its 
appointed agent will contact You to inform You of any changes and You 
agree that Your continued use of the Data shall be dependent on the 
parties entering into a new version of the Agreement.

15. You agree that you will submit a report to the Consortium Data 
Access Committee, if requested, on completion of the agreed purpose. The 
Consortium Data Access Committee agrees to treat the report and all 
information, data, results, and conclusions contained within such report 
as confidential information belonging to the User Institution.

16. You accept that the Data is protected by and subject to 
international laws, and that You are responsible for ensuring compliance 
with any such applicable law. The Consortium Data Access Committee 
reserves the right to request and inspect data security and management 
documentation to ensure the adequacy of data protection measures in 
countries that have no national laws comparable to that which pertain in 
the EAA.

17. This agreement shall be construed, interpreted and governed by the 
laws of the Netherlands and shall be subject to the non-exclusive 
jurisdiction of the Dutch courts.

SCHEDULE 1
Publications Policy
The primary purpose of the <...> Consortium is to accelerate efforts
to identify genome/transcriptome sequence variants in <...> tumours and
find covariates that predict response to <...> and <...> therapy,
through implementation and analysis of large-scale genome-wide association
studies. Additional objectives include the development and validation of
informatics and analytical solutions appropriate to the scale and nature of
the project, as well as use of the data generated to answer important methodological 
and biological questions relevant to association studies in general.
The Consortium anticipates that data generated from the project will be 
used by others, such as required for developing new analytical methods, 
in understanding patterns of expression, structural variants, polymorphism
and in guiding selection of markers to map genes involved in specific diseases.

Authors who use data from the project must acknowledge the <...> Consortium 
using the following wording "This study makes use of data generated for 
the <...> clinical trial [Cite the relevant primary publications,
including <...>,<...>,<...>]".
Users should note that the Consortium bears no responsibility for the 
further analysis or interpretation of these data, over and above that 
published by the Consortium.
=============================================================================================================

9. Choose 'Submit sequence reads and experiments' and make a Run (sequencing files)

 - Go to Studies, and find the matching studie identifier (EGAS0000....) and save it; needed for new tsv file

 - Press Next
 - Select Study
 - Press [Next >>]
 - In Sample menu, skip adding samples and press [Skip >>]
 - Fill in the Form

 - Make sure insert size is a single value rather than a range (use 200 instead of 150-300)
 - Remove the .gpg suffix from the fastq.gz files


Sequencer machines may be identifier using the read identifiers within the BAM/FASTQ files:
https://www.biostars.org/p/198143/



For the following table, for large cohorts you ideally test with uploading small example files first.

Select the appropriate format prior to uploading the description file (e.g. FASTQ paired).

File format for to be uploaded tsv file [per sample?]:
=============================================================================================================
project_accession	project_alias	sample_alias	run_alias	library_name	library_source	library_selection	library_strategy	library_construction_protocol	instrument_model	file_type	library_layout	insert_size	forward_file_name	reverse_file_name
EGAS00001002816	NGS-ProToCol PCa	7046-004-001	7046-004-001	unspecified	TRANSCRIPTOMIC	cDNA	RNA-seq	The NEBNext Ultra Directional RNA Library Prep Kit...	Illumina HiSeq 2500	fastq	PAIRED	450	7046-004-001_R1.fastq.gz	7046-004-001_R2.fastq.gz
EGAS00001002816	NGS-ProToCol PCa	7046-004-003	7046-004-003	unspecified	TRANSCRIPTOMIC	cDNA	RNA-seq	The NEBNext Ultra Directional RNA Library Prep Kit...	Illumina HiSeq 2500	fastq	PAIRED	450	7046-004-003_R1.fastq.gz	7046-004-003_R2.fastq.gz
=============================================================================================================

* removing the file_md5 column seems to work (jan-2023).

In case of ERROR:
ERROR: File "AAB1-1917_NGS19-J295_AHKK5WDSXX_S35_L002_R1_001.fastq.gz" does not exist in the upload area.
ERROR: File "AAB1-1917_NGS19-J295_AHKK5WDSXX_S35_L002_R2_001.fastq.gz" does not exist in the upload area.
ERROR: File "AAB1-1917_NGS19-J295_BHJTTYDSXX_S29_L001_R1_001.fastq.gz" does not exist in the upload area.
ERROR: File "AAB1-1917_NGS19-J295_BHJTTYDSXX_S29_L001_R2_001.fastq.gz" does not exist in the upload area.
ERROR: File "AAB2_NGS20-O001_AHGJCYDSXY_S65_L002_R1_001.fastq.gz" does not exist in the upload area.

Apparently it is possible that data files have been uploaded but that the Webin portal cannot see them.
You will get errors as above.
In that case, send an e-mail to the help-desk and wait for ~3 working days to have this resolved.



10. Choose 'Submit dataset'

 - Obtain all Runs and Analysis associated with the dataset - ID's:
   EGAR00001nnnnnn (Under section Runs)

 - Select the DAC matching your dataset
 - Select the policy matching your dataset and DAC

  - List all the EGAR ids delimited with a comma and a space

10.B - CROSS CHECK AFTER UPLOAD THE FTP ACCOUNT (!)

 - IF THERE ARE STILL FILES PRESENT IN THE FTP DIR, FILES WERE LIKELY RECEIVED IN AN INVALID STATE
 - WAIT A FEW DAYS TO SEE IF THEY GO THROUGH THE EGA PIPELINE
 - Directly contact their helpdesk: ega-helpdesk@ebi.ac.uk

11. Publish / release your dataset: ega-helpdesk@ebi.ac.uk

 - After submitting your dataset you should contact the EGA Helpdesk to provide a release date for your dataset.
 - ega-helpdesk@ebi.ac.uk with your dataset code identifier (EGAD0000....)
 - During upload, you can request to add certain 'DUOs' to the study, such as:
 
DUO:0000007 disease-specific research and clinical care
DUO:0000019 publication required
DUO:0000021 ethics approval required
DUO:0000026 user-specific restriction
DUO:0000027 project-specific restriction
DUO:0000028 institution-specific restriction


Z. tools

https://ega-archive.org/submission/dac/tools


# 12. 

I was appointed to the presence of the 'Submitted Portal':
https://ega-archive.org/submission/tools/submitter-portal
https://ega-archive.org/submitter-portal/#/login
